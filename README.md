## Traffic Sign Recognition 

#### Overview

The traffic sign project is about building a model based on the convolutional neural network concept in deep learning. Training, Validating and Testing the traffic sign classifier model is based on the German traffic signs dataset. 

#### The Project Steps:
* Load the data set (see below for links to the project data set)
* Explore, summarize and visualize the data set
* Design, train and test a model architecture
* Use the model to make predictions on new images
* Analyze the softmax probabilities of the new images
* Summarize the results with a written report 

You're reading it! and here is a link to my [project code](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/Traffic_Sign_Classifier.ipynb)

### 1. Data Set Summary & Exploration

These are the statistics of the traffic signs data set:

* The size of training set is 34799 + (34799*2) = 10397 // 34799*2 are generated by input images rotation
* The size of the validation set is 4410
* The size of test set is 12630
* The shape of a traffic sign image is [32, 32, 3]
* The number of unique classes/labels in the data set is 43

Here is an exploratory visualization of the data set.

![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/plot_hist.png)

### 2. Design and Test a Model Architecture

#### Preprocessing: 
In this phase, The image has 3 phases for preprocessing 
1. Convert to Grayscale: However the RGB images have more data, we know that the data from the color would need the model to be more complicated in the same time this type of information could be neglected and it won't affect our model so much
2. Apply CLAHE "Contrast Limited Adaptive Histogram Equalization": As we have grayscale image, we have only values from 0 to 255. Most of the values will be in the gray range not the white or the black so we need to apply CLAHE to have better insight from the image. In the next images, you will find the difference between the image before and after preprocessing 
3. Normalization: The input values are from 0 to 255 so we need to normalize these values to be from -1 to 1 as we will use relu activation function which works better with this range of input values. For normalization we use this formula ((value/255) - 0.5).


| Before			        |     After	        					| 
|:---------------------:|:---------------------------------------------:| 
| ![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/dataset_ex_before.png)         		| ![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/dataset_ex_After.png)   							| 

#### Augmentation
In this phase, the input images are rotated by 20 and -20 degrees and added to the training set.

| CW			        |     CCW	        					| 
|:---------------------:|:---------------------------------------------:| 
| ![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/dataset_ro_after_cw.png)         		| ![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/dataset_ro_after_ccw.png)   							| 

#### Model Archeticture:

| Layer         		|     Description	        					| 
|:---------------------:|:---------------------------------------------:| 
| Input         		| 32x32x1 Gray image   							| 
| Convolution 5x5     	| 1x1 stride, valid padding, outputs 28x28x10 	|
| RELU					|												|
| Max pooling	      	| 2x2 stride,  outputs 14x14x10 				|
| Convolution 5x5     	| 1x1 stride, valid padding, outputs 10x10x22 	|
| RELU					|												|
| Max pooling	      	| 2x2 stride,  outputs 5x5x22 				| 
| Flatten     	| 5x5x22 to 550 neurons 	|
| Fully Connected     	| input 550, output 350 	|
| RELU					|												|
| Dropout					|	0.8											|
| Fully Connected     	| input 350, output 43 |	 


### 3. Model Training

To train the model, I used the LeNet model for 10 epochs using 0.0055 learning rate, 150 Batch size and Adam optimizer instead of gradient descent.

| EPOCH         		|     Validation Accuracy	        					|      Training Accuracy	        					| 
|:---------------------:|:---------------------------------------------:|:---------------------------------------------:| 
| 1	      	| 0.948 				| 0.971 				|
| 2	      	| 0.950 				| 0.982 				|
| 3	      	| 0.955 				| 0.984 				|
| 4	      	| 0.946 				| 0.985 				|
| 5	      	| 0.963 				| 0.983 				|
| 6	      	| 0.950 				| 0.987 				|
| 7	      	| 0.959 				| 0.987 				|
| 8	      	| 0.960 				| 0.990 				|
| 9	      	| 0.958 				| 0.990 				|
| 10	      	| 0.958 				| 0.990 				|

### 4. Model Tuning
At the beginning the accuracy wasn't good (below 0.85) so I tried to use the inception model to train the model but it was so complicated and always tends to overfitting because of the large number of feature maps and the final number of input neurons to the fully connected NN. I got back the LeNet model and changed the batch size to be smaller (150) and increased the number of epochs to be 10. Tuning the number of feature maps was the key to increase the accuracy.

My final model results were:
* training set accuracy of 0.990
* validation set accuracy of 0.958 
* test set accuracy of 0.942
 

#### Test a Model on New Images

I have downloaded the German traffic sign dataset and I select 5 signs randomly from the dataset in each run, Here you can check the selected images after processing in the latest run:

![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/DE_image0.png) ![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/DE_image1.png) ![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/DE_image2.png) 
![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/DE_image3.png) ![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/DE_image4.png)

2nd and 3rd images have very low quality so it was expected that the model fails in predicting the right class as it's hard to extract the featues of the right class.

1st and 4th images have good quality so it's expected to be easy for the model to predict the right class as extracting the features will be easier.

After testing the selected images the accuracy was 1.0 which is a perfect prediction. The accuracy isn't always 1.0, sometimes it's 0.8 which means that one of the images was missed

Here are the results of the prediction:

| Image			        |     Prediction	        					| 
|:---------------------:|:---------------------------------------------:| 
| Speed limit (100km/h)      		| Speed limit (100km/h)   									| 
| Turn left ahead     			| Turn left ahead 										|
| Speed limit (60km/h)					| Speed limit (60km/h)											|
| Double curve	      		| Stop					 				|
| Speed limit (70km/h)			| Vehicles over 3.5 metric tons prohibited      							|

Using softmax probability gives better insight about the model prediction accuaracy, Here are the probability of the top 5 probabilities.

First Image top 5 probabilities:

| Probability         	|     Prediction	        					| 
|:---------------------:|:---------------------------------------------:| 
| 1.00         			| Speed limit (100km/h)   									| 
| .00     				| Speed limit (80km/h) 										|
| .00					| Speed limit (120km/h)											|
| .00	      			| Speed limit (30km/h)					 				|
| .00				    | Roundabout mandatory      							|

Second Image top 5 probabilities:

| Probability         	|     Prediction	        					| 
|:---------------------:|:---------------------------------------------:| 
| 1.00         			| Turn left ahead  									| 
| .00     				| Keep right 										|
| .00					| General caution											|
| .00	      			| Traffic signals					 				|
| .00				    | Speed limit (50km/h)      							|

Third Image top 5 probabilities:

| Probability         	|     Prediction	        					| 
|:---------------------:|:---------------------------------------------:| 
| 1.00         			| Speed limit (60km/h)  									| 
| .00     				| Speed limit (80km/h) 										|
| .00					| Speed limit (50km/h)											|
| .00	      			| Speed limit (30km/h)					 				|
| .00				    | Turn left ahead      							|

Fourth Image top 5 probabilities:

| Probability         	|     Prediction	        					| 
|:---------------------:|:---------------------------------------------:| 
| 1.00         			| Stop  									| 
| .00     				| Ahead only 										|
| .00					| Speed limit (120km/h)											|
| .00	      			| Speed limit (80km/h)					 				|
| .00				    | Roundabout mandatory      							|

Fifth Image top 5 probabilities:

| Probability         	|     Prediction	        					| 
|:---------------------:|:---------------------------------------------:| 
| 1.00         			| Vehicles over 3.5 metric tons prohibited  									| 
| .00     				| No passing 										|
| .00					| No vehicles											|
| .00	      			| Speed limit (100km/h)					 				|
| .00				    | Speed limit (30km/h)      							|


### Visualizing the Neural Network
#### Visualizing the feature maps in the neural network is very helpful. This image is the effect of each of the 22 feature maps on the input image
#### Input Image
![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/visualization_image.png)
#### Feature Map Effect
![alt text](https://github.com/AhmedMYassin/Traffic-Sign-Classifier/blob/master/examples/visualization.png)


